AC.define("flow/diff/Loader",["require","assetLoader/AssetLoader"],function(g){function e(b,d){var c,i,a=b.match(/#/g).length;
if(this.imagesUrls=[],!d){throw Error("0 images provided")}for(c=1;d>=c;c++){i="0000"+c,i=i.substring(i.length-a),this.imagesUrls.push(b.replace(/#{2,}/g,i))
}}var h,f=g("assetLoader/AssetLoader");return h=e.prototype,h.load=function(){return new f(this.imagesUrls).load()
},e}),AC.define("flow/diff/Render",["require","flow/diff/Loader","defer/Deferred"],function(i){function e(a,b){this.flowData=a,this.flowData.imageUrlPattern=b
}var j,g=i("flow/diff/Loader"),h=i("defer/Deferred");return j=e.prototype,j._storeImages=function(a){return this.images=a,this._blocksPerFullDiff=a[0].width/this.flowData.blockSize*(a[0].height/this.flowData.blockSize),(new h).resolve()
},j._applyDiffRange=function(f,G){for(var n,r,l=G.block,b=G.length,c=f.canvas.width/this.flowData.blockSize,u=Math.floor(l/this._blocksPerFullDiff),o=this.images[u].width,d=l%this._blocksPerFullDiff,t=o/this.flowData.blockSize,a=d%t*this.flowData.blockSize,p=Math.floor(d/(t||1))*this.flowData.blockSize,m=G.location%c*this.flowData.blockSize,s=Math.floor(G.location/c)*this.flowData.blockSize;
b;){n=Math.min(b*this.flowData.blockSize,f.canvas.width-m,o-a),r=n/this.flowData.blockSize,f.drawImage(this.images[u],a,p,n,this.flowData.blockSize,m,s,n,this.flowData.blockSize),b-=r,b&&((a+=n)>=o&&(a=0,p+=this.flowData.blockSize),(d+=r)>=this._blocksPerFullDiff&&(d=0,a=0,p=0,u+=1,u===this.flowData.imagesRequired-1&&(o=this.images[u].width)),(m+=n)>=f.canvas.width&&(m=0,s+=this.flowData.blockSize),l+=r)
}},j.init=function(){return new g(this.flowData.imageUrlPattern,this.flowData.imagesRequired).load().then(this._storeImages.bind(this))
},j.renderDiff=function(a,c){var b=a.getContext("2d");c-=1,this.frames[c].forEach(function(d){this._applyDiffRange(b,d)
}.bind(this))},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(j,{frames:{get:function(){return this.flowData.frames
},set:function(a){this.flowData.frames=a},enumerable:!0}}),e)}),AC.define("flow/compositor/Sequence",["require","assetLoader/AssetLoader","flow/diff/Render","defer/Deferred"],function(i){function k(c,b,d){this._keyframes=c,this._imageUrlPattern=b,this._flowDataProvider=d
}var j,l=i("assetLoader/AssetLoader"),e=i("flow/diff/Render"),a=i("defer/Deferred");
return j=k.prototype,j._initDiffRender=function(b){this._images=b,this.canvas.height=b[0].height,this.canvas.width=b[0].width,this.applyFrame(b[0])
},j.init=function(b){return this.canvas=b||document.createElement("canvas"),new l(this._keyframes).load().then(this._initDiffRender.bind(this)).then(this._flowDataProvider.load.bind(this._flowDataProvider))
},j.createDiffRender=function(b){return this._diffRender=new e(b,this._imageUrlPattern),this._diffRender.init()
},j.applyFrame=function(c){var b=this.canvas.getContext("2d");b.drawImage(c,0,0)
},j.calculateRenderCount=function(c,b){var d=0;return Math.abs(b-c)>=b?(c=1,d=1):Math.abs(b-c)>=this.frameCount-b&&this._images[1]&&(c=this.frameCount-2,d=1),b>0&&this.frameCount-1>b?Math.abs(c-b)+d:d
},j.compositeFrames=function(c,f){var d=new a;f=f>this.frameCount?this.frameCount-1:0>f?0:f,c=c>this.frameCount-2?this.frameCount-2:0>c?0:c;
var b;if(Math.abs(f-c)>=f?(c=1,this.applyFrame(this._images[0])):Math.abs(f-c)>=this.frameCount-f&&this._images[1]&&(c=this.frameCount-2,this.applyFrame(this._images[1])),b=c>f?-1:f>c?1:0,f>0&&this.frameCount-1>f){for(;
c!==f;){d.progress(c),this._diffRender.renderDiff(this.canvas,c),c+=b,d.progress(c)
}}return d.resolve(c),d.promise()},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(j,{frameCount:{get:function(){return this._diffRender.frames.length+2
},enumerable:!0},canvas:{get:function(){return this._canvas},set:function(b){return this._canvas=b
},enumerable:!0},mainCompositor:{get:function(){for(var b=this;b._compositor;){b=b._compositor
}return b},enumerable:!0}}),k)}),AC.define("flow/data/Manifest",[],function(){function b(){}return b
}),AC.define("flow/data/Block",[],function(){function b(d,a){this.location=d,this.length=a
}return b}),AC.define("flow/data/processor",["require","flow/data/Manifest","flow/data/Block"],function(i){var e,j=i("flow/data/Manifest"),g=i("flow/data/Block"),h={parseData:function(a){e=0;
var b=a.frames.map(this._parseFrame,this);return Object.create(j.prototype,{version:{value:a.version},framecount:{value:a.frameCount},blockSize:{value:a.blockSize},imagesRequired:{value:a.imagesRequired},reversible:{value:a.reversible},superframeFrequency:{value:a.superframeFrequency},frames:{value:b}})
},_valueForCharAt:function(a,c){var b=a.charCodeAt(c);if(b>64&&91>b){return b-65
}if(b>96&&123>b){return b-71}if(b>47&&58>b){return b+4}if(43===b){return 62}if(47===b){return 63
}throw"Invalid Bas64 character: "+a.charAt(c)},_createNumberFromBase64Range:function(b,d,c){for(var f,a=0;
c--;){f=this._valueForCharAt(b,d++),a+=f<<6*c}return a},_parseFrame:function(c){var d,b,f,a=[],c=c.value||c;
for(d=0;c.length>d;d+=5){f=this._createNumberFromBase64Range(c,d,3),b=this._createNumberFromBase64Range(c,d+3,2),a.push(Object.create(g.prototype,{location:{value:f,enumerable:!0},length:{value:b,enumerable:!0},block:{value:(e+=b)-b,enumerable:!0}}))
}return a}};return h}),AC.define("flow/data/provider/Async",["require","ajax/Ajax","flow/data/processor"],function(i){function e(a,b){this._url=a,this._ajaxAdaptor=b||new g
}var j,g=i("ajax/Ajax"),h=i("flow/data/processor");return j=e.prototype,j.load=function(){var a=this;
return this._ajaxAdaptor.get(this._url).then(function(b){try{var d=b.reponse||b.responseText;
return JSON.parse(d)}catch(c){}}).then(function(b){return a._data=b,h.parseData(b)
})},e}),AC.define("flow/data/provider/Sync",["require","defer/Deferred","flow/data/processor"],function(i){function e(a){this._data=a
}var j,g=i("defer/Deferred"),h=i("flow/data/processor");return j=e.prototype,j.load=function(){var a=new g;
return a.resolve(h.parseData(this._data)),a.promise()},e}),AC.define("flow/Player",["require","defer/Deferred"],function(g){function e(a,b){this._flow=b,this._frameRate=30,this.element=a,this.paused=!0,this.loop=!1
}var h,f=g("defer/Deferred");return h=e.prototype,h._dispatchEvent=function(a){var b=document.createEvent("Events");
return b.initEvent(a,!0,!1),b.data=this,this.element.dispatchEvent(b),b},h._timeToFrame=function(a){var b;
return b=Math.round(a/this.duration*this._flow.frameCount),b%=this._flow.frameCount+1,0>b?this._flow.frameCount+b:b
},h._advanceToTimeGlobal=function(a){this._prevTime=this._prevTime||a,this._currentTime+=(a-this._prevTime)/1000*this.playbackRate,this._prevTime=a;
var c=this._timeToFrame(this._currentTime),b=!1;return this.loop?this._currentTime=(this.duration+this._currentTime)%this.duration:this.playbackRate>0&&this._currentTime>this.duration?(c=this._flow.frameCount,this._currentTime=this.duration,b=!0):0>this.playbackRate&&0>this._currentTime&&(c=0,this._currentTime=0,b=!0),this.paused||this.seeking?(new f).reject():this._flow.gotoFrame(c).then(function(){this._dispatchEvent("timeupdate"),b?(this.paused=!0,this._dispatchEvent("ended")):this._requestAnimationFrame=window.requestAnimationFrame(this._advanceToTimeGlobal.bind(this))
}.bind(this))},h._advanceToTimeLocal=function(a){this.seeking||(this.seeking=!0,this._dispatchEvent("seeking"),this._currentTime=1*a,window.cancelAnimationFrame(this._requestAnimationFrame),this._flow.gotoFrame(this._timeToFrame(a)).then(function(){this.seeking=!1,this._dispatchEvent("timeupdate"),this._dispatchEvent("seeked"),this._requestAnimationFrame=window.requestAnimationFrame(this._advanceToTimeGlobal.bind(this))
}.bind(this)))},h.load=function(){return this._dispatchEvent("loadstart"),this._flow.init(this.element).then(this._dispatchEvent.bind(this,"canplaythrough"))
},h.play=function(){return this.paused&&(this.paused=!1,this._dispatchEvent("play"),this._prevTime=0,this._requestAnimationFrame=window.requestAnimationFrame(this._advanceToTimeGlobal.bind(this))),this
},h.pause=function(){return this.paused||(this.paused=!0,window.cancelAnimationFrame(this._requestAnimationFrame),this._dispatchEvent("pause"),this._prevTime=0),this
},h.on=function(){this.element.addEventListener.apply(this.element,arguments)},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(h,{_currentTime:{value:0,enumerable:!1,writable:!0},_playbackRate:{value:1,enumerable:!1,writable:!0},currentTime:{get:function(){return 1*this._currentTime
},set:h._advanceToTimeLocal,enumerable:!0},frameRate:{get:function(){return this._frameRate
},set:function(a){isFinite(a)&&(this._frameRate=a,this._dispatchEvent("durationchange"))
},enumerable:!0},playbackRate:{get:function(){return 1*this._playbackRate},set:function(a){isFinite(a)&&(this._playbackRate=1*a,this._dispatchEvent("ratechange"))
},enumerable:!0},duration:{get:function(){return this._flow.frameCount/this.frameRate
},enumerable:!0}}),e)}),AC.define("flow/keyframe/Loader",["require","assetLoader/AssetLoader","defer/Deferred"],function(i){function e(a,c){var b,d=a.match(/#/g).length;
this._keyframes={},a=a.replace(/([^#]+)(#+)(\..*)/,"$1key_$2$3"),this._imageUrls=[],c.frames&&c.frames.forEach(function(k,f){"keyframe"===k.type&&(b="0000"+f,b=b.substring(b.length-d),this._imageUrls.push(a.replace(/#+/g,b)),this._keyframes[f]=k)
}.bind(this))}var j,g=i("assetLoader/AssetLoader"),h=i("defer/Deferred");return j=e.prototype,j.load=function(){return this._imageUrls.length>0?new g(this._imageUrls).load():(new h).resolve()
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(j,{keyframes:{get:function(){return this._keyframes
},enumerable:!0}}),e)}),AC.define("flow/keyframe/Render",["require","flow/keyframe/Loader"],function(g){function e(a,b){this.flowData=a,this.flowData.imageUrlPattern=b
}var h,f=g("flow/keyframe/Loader");return h=e.prototype,h._storeImages=function(a){var c,b=0;
if(a&&a.length>0){for(var d in this._loader._keyframes){this._loader._keyframes.hasOwnProperty(d)&&(c=a[b],this._loader._keyframes[d].image=c,b+=1)
}}},h.init=function(){return this._loader=new f(this.flowData.imageUrlPattern,this.flowData),this._loader.load().then(this._storeImages.bind(this))
},h.renderKeyframe=function(c,t,r){var i=c.getContext("2d"),o=this._loader.keyframes[t],a=o.image,n=o.x,s=o.y,d=o.width,b=o.height;
r===!0?i.drawImage(a,n,s,d,b,n,s,d,b):this.flowData.reversible?i.drawImage(a,0,0):i.drawImage(a,n,s,d,b)
},e}),AC.define("flow/compositor/decorator/Keyframe",["require","flow/keyframe/Render","defer/Deferred"],function(i){function e(a){this._compositor=a,this._flowDataProvider=this.mainCompositor._flowDataProvider
}var j,g=i("flow/keyframe/Render"),h=i("defer/Deferred");return j=e.prototype,j.init=function(){return this._keyframeDiffRender=new g(this._flowDataProvider._data,this.mainCompositor._imageUrlPattern),this._keyframeDiffRender.init()
},j.applyFrame=function(){return this._compositor.applyFrame.apply(this._compositor,arguments)
},j.applyKeyframe=function(a,b){this._keyframeDiffRender.renderKeyframe(this.canvas,a,b)
},j.compositeFrames=function(a,c){if(!this._isKeyframeDiff(c-1)){return this._compositor.compositeFrames.apply(this._compositor,arguments)
}var b=new h;return this.applyKeyframe(c-1),b.resolve(a-1),b.promise()},j._isKeyframeDiff=function(a){return a in this._keyframeDiffRender._loader._keyframes
},j.calculateRenderCount=function(){return this._compositor.calculateRenderCount.apply(this._compositor,arguments)
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(j,{frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0},canvas:{get:function(){return this._compositor.canvas},set:function(a){return this._compositor.canvas=a
},enumerable:!0},mainCompositor:{get:function(){return this._compositor.mainCompositor
},enumerable:!0}}),e)}),AC.define("flow/compositor/decorator/Superframe",[],function(){function c(a,b){this._compositor=a,this._superframeInterval=b||4
}var d;return d=c.prototype,d._getClosestSuperframe=function(a){return Math.round(a/this._superframeInterval)*this._superframeInterval
},d.init=function(a){this._screenCanvas=a},d.applyFrame=function(){this._compositor.applyFrame.apply(this._compositor,arguments)
},d.calculateRenderCount=function(a,e){var b=this._getClosestSuperframe(a);return Math.abs(b-e)>this._superframeInterval/2?(a=b+(a>e?-1:1)*this._superframeInterval,this.calculateRenderCount(a,e)+1):Math.abs(b-e)+1
},d.compositeFrames=function(a,e){var b,h;return(0>=e||e>=this.frameCount-2)&&this._compositor.compositeFrames(a,e),a>this.frameCount-2?a=this.frameCount-2:0>=a&&(a=1),h=this._getClosestSuperframe(a),b=this._compositor.calculateRenderCount(a,e)>this.calculateRenderCount(a,e)?this._compositor.compositeFrames(h,h).then(function(){var f=h+(a>e?-1:1)*this._superframeInterval;
this._compositor.compositeFrames(h,f).then(function(){return this.compositeFrames(f,e)
}.bind(this))}.bind(this)):this._compositor.compositeFrames(a,e).then(function(){}.bind(this)),b.then(function(){}.bind(this)),b
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(d,{frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0},canvas:{get:function(){return this._compositor.canvas},set:function(a){return this._compositor.canvas=a
},enumerable:!0},mainCompositor:{get:function(){return this._compositor.mainCompositor
},enumerable:!0}}),c)}),AC.define("flow/compositor/decorator/SuperKeyframe",["require","defer/Deferred"],function(g){function e(a){this._compositor=a,this._frames=this.mainCompositor._flowDataProvider._data.frames,this._superframeInterval=this.mainCompositor._diffRender.flowData.superframeFrequency
}var h,f=g("defer/Deferred");return h=e.prototype,h.init=function(){return this._compositor.init.apply(this._compositor,arguments)
},h.applyFrame=function(){return this._compositor.applyFrame.apply(this._compositor,arguments)
},h.applyKeyframe=function(){this._compositor.applyKeyframe.apply(this._compositor,arguments)
},h.compositeFrames=function(b,d){var c,a,k=new f;return 1>d||d>this.frameCount-2?this._compositor.compositeFrames.apply(this._compositor,arguments):this._isKeyframeDiff(d-1)?(c=1===Math.abs(b-d)?!0:!1,this.applyKeyframe(d-1,c),k.resolve(b-1),k.promise()):Math.abs(d-b)>this._superframeInterval&&(a=this._getShortestRender(b,d),this._isKeyframeDiff(a-1)||0>=a||a>=this.frameCount-2)?this._compositeFromSuperKeyframe(a,d):this._compositor.compositeFrames.apply(this._compositor,[b,d])
},h._getShortestRender=function(b,d){var c=this._compositor.calculateRenderCount,i=this._getClosestSuperKeyframe(d-1),a=c.apply(this._compositor,[i,d])+1,m=c.apply(this._compositor,[b,d]);
return m>=a?i:b},h._compositeFromSuperKeyframe=function(a,c){var b=this.canvas.getContext("2d"),d=0>=a?this.mainCompositor._images[0]:a>=this.frameCount-2?this.mainCompositor._images[1]:this._frames[a-1].image;
return b.drawImage(d,0,0),this._compositor.compositeFrames.call(this._compositor,a,c)
},h._getClosestSuperFrame=function(a){return Math.round(a/this._superframeInterval)*this._superframeInterval
},h._getClosestSuperKeyframe=function(b){var d,c,i,a,m=this._frames.length;if(m+1>b&&b>0){for(a=b-1;
a>=0;){if("keyframe"===this._frames[a].type){d=a+1;break}a-=1}for(a=b+1;m-1>=a;
){if("keyframe"===this._frames[a].type){c=a+1;break}a+=1}}return d=d?d:0,c=c?c:this.frameCount,i=c-b>b-d?d:c
},h._isKeyframeDiff=function(){return this._compositor._isKeyframeDiff.apply(this._compositor,arguments)
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(h,{frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0},canvas:{get:function(){return this._compositor.canvas},set:function(a){return this._compositor.canvas=a
},enumerable:!0},mainCompositor:{get:function(){return this._compositor.mainCompositor
},enumerable:!0}}),e)}),AC.define("flow/compositor/decorator/Cache",[],function(){function c(a,b){this._compositor=a,this._keyframeInterval=b||8,this._keyframes=[]
}var d;return d=c.prototype,d._getClosestKeyframe=function(a){var e=a%this._keyframeInterval,b=Math.floor(a/this._keyframeInterval)+(e>this._keyframeInterval/2?1:0);
return b},d._getFrameFromKeyframe=function(a){return a*this._keyframeInterval},d._saveKeyframe=function(a){var e,b=Math.floor(a/this._keyframeInterval);
0!==a%this._keyframeInterval||this._keyframes[b]||(e=document.createElement("canvas"),e.width=this._compositor.canvas.width,e.height=this._compositor.canvas.height,e.getContext("2d").drawImage(this._compositor.canvas,0,0),this._keyframes[b]=e)
},d.init=function(){return this._compositor.init.apply(this._compositor,arguments)
},d.applyFrame=function(){this._compositor.applyFrame.apply(this._compositor,arguments)
},d.calculateRenderCount=function(a,b){return a=this._getFrameFromKeyframe(this._getClosestKeyframe(b)),this._compositor.calculateRenderCount(a,b)+1
},d.compositeFrames=function(a,e){var b=this._getClosestKeyframe(e);return this._keyframes[b]&&this._compositor.calculateRenderCount(a,e)>this.calculateRenderCount(a,e)?(a=this._getFrameFromKeyframe(b),this.applyFrame(this._keyframes[b]),this._compositor.compositeFrames(a,e).then(function(){})):this._compositor.compositeFrames(a,e).then(function(){},null,this._saveKeyframe.bind(this))
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(d,{frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0},canvas:{get:function(){return this._compositor.canvas},set:function(a){return this._compositor.canvas=a
},enumerable:!0}}),c)}),AC.define("stats/Benchmark",[],function(){function b(a){this.name=a
}return b.prototype.start=function(){},b.prototype.end=function(){},b}),AC.define("flow/compositor/decorator/Benchmark",["require","stats/Benchmark"],function(g){function e(a){this._compositor=a
}var h,f=g("stats/Benchmark");return h=e.prototype,h.init=function(){var a=new f("init");
return a.start(),this._compositor.init.apply(this._compositor,arguments).then(a.end.bind(a))
},h.applyFrame=function(){var a=new f("applyFrame");a.start(),this._compositor.applyFrame.apply(this._compositor,arguments),a.end.bind(a)
},h.calculateRenderCount=function(){return this._compositor.calculateRenderCount.apply(this._compositor,arguments)
},h.compositeFrames=function(){var a=new f("renderFrames");return a.start(),this._compositor.compositeFrames.apply(this._compositor,arguments).then(a.end.bind(a))
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(h,{frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0},canvas:{get:function(){return this._compositor.canvas},set:function(a){return this._compositor.canvas=a
},enumerable:!0}}),e.prototype=h,e)}),AC.define("flow/Flow",["require","defer/Deferred","flow/compositor/decorator/Keyframe","flow/compositor/decorator/Superframe","flow/compositor/decorator/SuperKeyframe","flow/compositor/decorator/Cache","flow/compositor/decorator/Benchmark"],function(i){function e(c,b){this._compositor=c,this.options=b||{}
}var r,o=i("defer/Deferred"),q=i("flow/compositor/decorator/Keyframe"),f=i("flow/compositor/decorator/Superframe"),p=i("flow/compositor/decorator/SuperKeyframe"),a=i("flow/compositor/decorator/Cache"),n=i("flow/compositor/decorator/Benchmark");
return r=e.prototype,r.gotoFrame=function(b){return this._rendering?(new o).resolve():this._currentFrame===b?(new o).resolve():(this._rendering=!0,this._compositor.compositeFrames(this._currentFrame,b).then(function(){this._rendering=!1,this._currentFrame=b
}.bind(this)))},r.init=function(c){var b;return"CANVAS"===c.nodeName?b=c:(b=document.createElement("canvas"),c.appendChild(b)),this._compositor.init(b).then(function(d){return o.all([this._compositor.createDiffRender(d).then(this._decorateCompositor.bind(this))])
}.bind(this))},r._decorateCompositor=function(){var c=this._compositor,b=this._compositor._diffRender.flowData,d=this._compositor.canvas;
return b.superframeFrequency&&(c=new f(c,b.superframeFrequency)),3===b.version&&(c=new q(c)),3===b.version&&b.superframeFrequency&&(c=new p(c)),this.options.keyframeCache&&(c=new a(c,this.options.keyframeCache)),this.options.benchmark&&(c=new n(c)),c===this._compositor?(new o).resolve():(this._compositor=c,this._compositor.init(d))
},"function"!=typeof Object.defineProperties?function(){}:(Object.defineProperties(r,{_currentFrame:{value:0,enumerable:!1,writable:!0},frameCount:{get:function(){return this._compositor.frameCount
},enumerable:!0}}),e)}),AC.define("flow/playerFactory",["require","flow/compositor/Sequence","flow/data/provider/Async","flow/data/provider/Sync","flow/Player","flow/Flow"],function(k){function m(h,d,r,j,g){var c,f,b;
return g=g||{},g={keyframeCache:g.keyframeCache===void 0?8:g.keyframeCache,benchmark:g.benchmark===void 0?!1:g.benchmark,preload:g.preload===void 0?!0:g.preload},d=d||[h.getAttribute("data-start-frame")],h.getAttribute("data-end-frame")&&d.push(h.getAttribute("data-end-frame")),r=r||h.getAttribute("data-image-url-pattern"),b="string"==typeof j?new n(j):new i(j),c=new l(d,r,b),f=new a(h,new e(c,g)),g.preload&&f.load(),f
}var l=k("flow/compositor/Sequence"),n=k("flow/data/provider/Async"),i=k("flow/data/provider/Sync"),a=k("flow/Player"),e=k("flow/Flow");
return m});